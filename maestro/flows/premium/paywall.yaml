appId: com.nutritionrx.app
name: Paywall Flow
tags:
  - premium
  - paywall
---
- launchApp:
    clearState: true
- runFlow: ../../utils/complete-onboarding.yaml

# In dev builds, isPremium defaults to true (__DEV__), so the settings premium row
# opens the Play Store instead of the in-app paywall. Use deep link to open paywall directly.
# Note: On Android, openLink with custom scheme triggers "Open in NutritionRx?" dialog.
- openLink: "nutritionrx://paywall?context=general"

# Dismiss Android "Open in NutritionRx?" confirmation dialog if present
- tapOn:
    text: "nutritionrx"
    optional: true

- tapOn:
    text: "Open"
    optional: true

# Paywall screen may have loading state
- extendedWaitUntil:
    visible:
      id: "paywall-screen"
    timeout: 15000

# Verify close button (always visible, even during loading)
- assertVisible:
    id: "paywall-close-button"

# Wait for offerings to load, then assert all paywall elements strictly
# Note: In dev builds without RevenueCat configured, offerings may not load
# and the subscribe button may not appear. This test requires proper RevenueCat setup.
- extendedWaitUntil:
    visible:
      id: "paywall-subscribe-button"
    timeout: 20000

- assertVisible:
    id: "paywall-subscribe-button"
- assertVisible:
    id: "paywall-restore-button"
- assertVisible:
    id: "paywall-terms-link"
- assertVisible:
    id: "paywall-privacy-link"

# Close paywall
- tapOn:
    id: "paywall-close-button"

# After deep-link open, closing paywall returns to whatever was active (home screen after onboarding)
- extendedWaitUntil:
    visible:
      id: "home-screen"
    timeout: 5000
