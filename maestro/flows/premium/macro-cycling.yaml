appId: com.nutritionrx.app
name: Macro Cycling Setup
tags:
  - premium
  - macro-cycling
---
- launchApp:
    clearState: true
- runFlow: ../../utils/complete-onboarding.yaml

# Enable premium
- runFlow: ../../utils/enable-premium.yaml

- tapOn:
    id: "tab-bar-settings"

- extendedWaitUntil:
    visible:
      id: "settings-screen"
    timeout: 5000

- waitForAnimationToEnd

# Scroll to top first (enable-premium may have left scroll partway)
- swipe:
    direction: DOWN
    duration: 500
- swipe:
    direction: DOWN
    duration: 500
- swipe:
    direction: DOWN
    duration: 500
- swipe:
    direction: DOWN
    duration: 500
- swipe:
    direction: DOWN
    duration: 500

# Use scrollUntilVisible to find macro cycling row (settings is a ScrollView)
- scrollUntilVisible:
    element:
      id: "settings-macro-cycling-row"
    direction: DOWN
    timeout: 10000

- tapOn:
    id: "settings-macro-cycling-row"

- extendedWaitUntil:
    visible:
      id: "macro-cycling-screen"
    timeout: 5000

# Verify elements
- assertVisible:
    id: "macro-cycling-close-button"

# Select a pattern
- assertVisible:
    id: "macro-cycling-pattern-option-high-low"

- tapOn:
    id: "macro-cycling-pattern-option-high-low"

- waitForAnimationToEnd

# Select days
- assertVisible:
    id: "macro-cycling-day-pill-0"

- tapOn:
    id: "macro-cycling-day-pill-0"

- waitForAnimationToEnd

# Continue through setup
- assertVisible:
    id: "macro-cycling-continue-button"

- tapOn:
    id: "macro-cycling-continue-button"

# Close
- tapOn:
    id: "macro-cycling-close-button"

- extendedWaitUntil:
    visible:
      id: "settings-screen"
    timeout: 5000
