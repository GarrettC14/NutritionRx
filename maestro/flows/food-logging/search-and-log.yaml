appId: com.nutritionrx.app
name: Search and Log Food
tags:
  - food-logging
  - search
---
- launchApp:
    clearState: true
- runFlow: ../../utils/complete-onboarding.yaml

- assertVisible:
    id: "home-screen"

# Wait for skeleton to dismiss (home-date-label only renders after isReady)
- extendedWaitUntil:
    visible:
      id: "home-date-label"
    timeout: 8000

# Swipe down to meal sections (DraggableFlatList doesn't support scrollUntilVisible)
- swipe:
    direction: UP
    duration: 500
- swipe:
    direction: UP
    duration: 500
- swipe:
    direction: UP
    duration: 500
- swipe:
    direction: UP
    duration: 500

# Add food to breakfast
- tapOn:
    id: "meal-add-food-button-breakfast"

- extendedWaitUntil:
    visible:
      id: "add-food-screen"
    timeout: 5000

# Verify search elements
- assertVisible:
    id: "add-food-search-input"
- assertVisible:
    id: "add-food-scan-fab"
- assertVisible:
    id: "add-food-tab-all"

# Search for food
- tapOn:
    id: "add-food-search-input"
- inputText: "chicken breast"

# Wait for search debounce + API response + render
- extendedWaitUntil:
    visible:
      id: "add-food-search-result-item-.*"
    timeout: 10000

# Tap a search result
- tapOn:
    id: "add-food-search-result-item-.*"
    index: 0

# Log Food screen
- extendedWaitUntil:
    visible:
      id: "log-food-screen"
    timeout: 3000

- assertVisible:
    id: "log-food-back-button"
- assertVisible:
    id: "log-food-favorite-button"
- assertVisible:
    id: "log-food-amount-input"
- assertVisible:
    id: "log-food-add-button"

# Verify meal is pre-selected
- assertVisible:
    id: "log-food-meal-breakfast"

# Adjust amount
- tapOn:
    id: "log-food-amount-input"
- eraseText
- inputText: "150"

- hideKeyboard

# Add to log
- tapOn:
    id: "log-food-add-button"

# Wait for animation/navigation
- waitForAnimationToEnd

# Navigate home via tab bar (dismiss may land on add-food screen)
- tapOn:
    id: "tab-bar-home"

- extendedWaitUntil:
    visible:
      id: "home-screen"
    timeout: 3000
